---
title: 'WÅ‚asne bloki w WordPress Gutenberg #006 â€“ Format API'
seoTitle: NarzÄ™dzia formatowania we wÅ‚asnych blokach Gutenberg
abstract: W tej czÄ™Å›ci serii o WordPress Gutenbergu, zajmiemy siÄ™Â Format API - podepniemy narzÄ™dzia formatowania pod przycisk widoczny w toolbarze ğŸ‰
isPublished: true
topics:
  - WordPress
  - WÅ‚asne bloki w WordPress Gutenberg
date: 06.04.2021
isPopular: false
menuOrder: 0
---

DziÅ› sprawimy, Å¼e utworzony w poprzedniej czÄ™Å›ci przycisk, widoczny w toolbarze, stanie siÄ™ w peÅ‚ni funkcjonalny! Wszystko dziÄ™ki Format API i moÅ¼liwoÅ›ci dodania wÅ‚asnego formatowania do blokÃ³w w WordPress Gutenbergu.

## Co bÄ™dzie naszym celem?

Pozwolimy naszemu buttonowi:

![](./toolbar.jpg)

...aplikowaÄ‡ konkretne style dla zaznaczonego tekstu, tak samo jak dzieje siÄ™ to w przypadku pogrubienia, kursywy i tym podobnych. W momencie, gdy klikniemy w sam przycisk, zaznaczony tekst zostanie zamkniÄ™ty w spanie, ktÃ³remu nadamy konkretne style.

import VideoInterlude from 'VideoInterlude';

<VideoInterlude id="UkKRCGuNOWY" title="WÅ‚asne bloki w WordPress Gutenberg #006 - Format API" />

Wydaje siÄ™ to nieskomplikowane, wiÄ™c przejdÅºmy do rzeczy!

## Na poczÄ…tek standardowo - zaimportujmy zaleÅ¼noÅ›ci, ktÃ³re przydadzÄ… siÄ™ w pracy z Format API

W pliku .js samego bloku, dodamy 2 dodatkowe funkcje:

```jsx
import { registerFormatType, toggleFormat } from '@wordpress/rich-text';
```

A z racji, Å¼e jest to pierwszy raz, w ktÃ³rym importujemy cokolwiek z paczki `@wordpress/rich-text`, to samÄ… zaleÅ¼noÅ›Ä‡ musimy teÅ¼ podpiÄ…Ä‡ w pliku PHP wtyczki.

## Ale tym razem zautomatyzujemy dodawanie zaleÅ¼noÅ›ci w pliku .php!

W momencie, gdy zajrzysz do tego pliku (zakÅ‚adajÄ…c, Å¼e tworzysz rzeczy rÃ³wno ze mnÄ…), to Twoja funkcja rejestrujÄ…ca skrypt z blokiem, wyglÄ…da w mniej wiÄ™cej ten sposÃ³b:

```jsx
wp_register_script(
  'table-of-contents',
  plugin_dir_url(__FILE__) . 'build/index.js',
  array('wp-blocks', 'wp-editor', 'wp-components')
);
```

W ostatnim argumencie, masz tablicÄ™ z trzema zaleÅ¼noÅ›ciami, a teraz musimy dodaÄ‡ czwartÄ…. Dodatkowo w przyszÅ‚oÅ›ci, w miarÄ™ jak do naszego bloku bÄ™dÄ… dodawane kolejne funkcje, tych zaleÅ¼noÅ›ci bÄ™dzie jeszcze wiÄ™cej.

A co chyba najgorsze, przy kaÅ¼dym imporcie w pliku .js, musimy pamiÄ™taÄ‡ o aktualizacji tej tablicy. Jest to upierdliwe.

I tu przychodzi rozwiÄ…zanie wszystkich tych problemÃ³w! Zajrzyj proszÄ™ do folderu `/build` w katalogu caÅ‚ej wtyczki, a znajdziesz tam plik o nazwie `index.asset.php`.

W nim znajdujÄ… siÄ™ wszystkie zaleÅ¼noÅ›ci, z ktÃ³rych korzysta nasz plik .js oraz dodatkowo wersja, ktÃ³rÄ… teÅ¼ bÄ™dziemy w stanie podpiÄ…Ä‡ do funkcji rejestrujÄ…cej skrypt. Wersja, ktÃ³ra zmienia siÄ™ przy kaÅ¼dym buildzie pliku i usuwa problemy z pozostaÅ‚ym cachem w przeglÄ…darce, ktÃ³re w przeciwnym razie mogÅ‚yby siÄ™ pojawiaÄ‡.

Okej, rozgadaÅ‚em siÄ™, wiÄ™c podepnijmy nasze zaleÅ¼noÅ›ci:

```php
$dependencies = include(plugin_dir_path(__FILE__) . 'build/index.asset.php');

wp_register_script(
  'table-of-contents',
  plugin_dir_url(__FILE__) . 'build/index.js',
  $dependencies['dependencies'],
  $dependencies['version'],
);
```

A teraz wrÃ³Ä‡my do edycji samego bloku!

## Po pierwsze: PrzenieÅ›my kod naszego toolbara do osobnego komponentu

U mnie bÄ™dzie to wyglÄ…daÄ‡ nastÄ™pujÄ…co:

```jsx
const HighlightButton = (props) => (
  <BlockControls>
    <Toolbar>
      <ToolbarButton
        label="Zaznaczenie"
        className="highlight-button"
        onClick={() => {
          props.onChange(toggleFormat(props.value, { type: 'custom-formats/highlight' }));
        }}
        isActive={props.isActive}
      >
        <Icon icon="admin-customizer" />
      </ToolbarButton>
    </Toolbar>
  </BlockControls>
);
```

Okej, przyznajÄ™ siÄ™ - zrobiÅ‚em tu wiÄ™cej, niÅ¼ samo stworzenie funkcji i przeniesienie do niej kodu toolbara ğŸ˜¬ Ale juÅ¼ tÅ‚umaczÄ™!

NajwaÅ¼niejsza zmiana, to funkcja, ktÃ³rÄ… podpinam pod zdarzenie onClick. `setHighlightButtonState()` zostaÅ‚a usuniÄ™ta (wywoÅ‚anie, jak i deklaracja) i zastÄ…piona anonimowÄ…, ktÃ³ra przeÅ‚Ä…cza nasz nowy format. Do tego celu uÅ¼ywamy metody `onChange()`, sprawdzajÄ…cej, czy stan komponentu siÄ™ zmieniÅ‚. Z kolei w jej argumencie wrzucamy innÄ… metodÄ™ - `toggleFormat()`, ktÃ³ra zajmie siÄ™ przeÅ‚Ä…czaniem podanego formatu, dla zaznaczonego tekstu.

Dodatkowo informacja o zaznaczeniu konkretnego buttona (w propsie `isActive`) nie pochodzi juÅ¼ z naszej autorskiej funkcji, a z wÅ‚aÅ›ciwoÅ›ci propsÃ³w - teÅ¼ o nazwie `isActive`.

> Dla jasnoÅ›ci - razem z usuniÄ™ciem funkcji `setHighlightButtonState()`, pozbyÅ‚em siÄ™ teÅ¼ atrybutu `isHighlightButtonActive` i caÅ‚ej reszty kodu z nim zwiÄ…zanej.

## Po drugie: SwÃ³rzmy sam format!

A do tego posÅ‚uÅ¼y nam taki oto skrawek kodu:

```jsx
registerFormatType('custom-formats/highlight', {
  title: 'Zaznaczenie',
  tagName: 'span',
  className: 'highlight',
  edit: HighlightButton,
});
```

Korzystamy z pobranej funkcji i w argumentach podajemy identyfikator nowego formatu oraz obiekt zawierajÄ…cy:

- ÅadnÄ… nazwÄ™ tegoÅ¼ formatu;
- Tag, w ktÃ³ry zostanie zamkniÄ™ty zaznaczony tekst;
- KlasÄ™ przypisanÄ… do tego tagu;
- Komponent przycisku, powiÄ…zanego z nowym formatem.

Dodatkowo, dziÄ™ki wÅ‚aÅ›ciwoÅ›ci `attributes` (ktÃ³rej nie uÅ¼yjÄ™ w przypadku tworzonego przez nas zaznaczenia), do konkretnego skrawku tekstu moÅ¼emy przypisaÄ‡ atrybuty wÅ‚aÅ›ciwe dla podanego elementu HTMLa. Te pÃ³Åºniej bÄ™dziemy edytowaÄ‡ lub definiowaÄ‡ w samym komponencie powiÄ…zanym z formatem.

Dla przykÅ‚adu, tworzÄ…c format linku i chcÄ…c edytowaÄ‡ jego `href`, musielibyÅ›my zainicjowaÄ‡ ten zamiar w obiekcie `attributes`:

```jsx
registerFormatType('custom-formats/link', {
  title: 'Link',
  tagName: 'a',
  className: 'custom-link',
  attributes: {
  	url: 'href',
  }
  edit: CustomLink,
});
```

DziÄ™ki czemu pÃ³Åºniej w metodzie `toggleFormat()`, w podpiÄ™tym komponencie, moglibyÅ›my edytowaÄ‡ wartoÅ›Ä‡ atrybutu `href` odwoÅ‚ujÄ…c siÄ™ do klucza `url`, do ktÃ³rego zostaÅ‚ przypisany:

```jsx
// ...

toggleFormat(props.value, {
  type: 'custom-formats/link',
  attributes: { url: 'https://example.com' },
});

// ...
```

To mamy jasne. W takim razie wrÃ³Ä‡my do poprzedniego skrawka kodu i zrÃ³bmy jeszcze jednÄ… rzecz, ktÃ³rej nam brakuje.

## Po trzecie: PozwÃ³lmy nowemu formatowi, aplikowaÄ‡ siÄ™ dla spisu treÅ›ci

Jak zapewne pamiÄ™tasz, w poprzedniej czÄ™Å›ci serii, ograniczyliÅ›my dozwolone formaty dla dwÃ³ch RichTextÃ³w, ktÃ³re skÅ‚adajÄ… siÄ™ na tworzony przez nas blok:

```jsx
allowedFormats={[
  'core/bold',
  'core/italic',
  'core/link',
  'core/text-color',
  'core/strikethrough',
]}
```

WiÄ™c aby nasz nowy format teÅ¼ mÃ³gÅ‚ siÄ™ tam aplikowaÄ‡, musimy go dodaÄ‡ do samej tablicy:

```jsx
allowedFormats={[
  'core/bold',
  'core/italic',
  'core/link',
  'core/text-color',
  'core/strikethrough',
  'custom-formats/highlight',
]}
```

## Po czwarte: Zdefiniujmy styl naszego formatu

PamiÄ™tajÄ…c, Å¼e nasz format jest de facto spanem o konkretnej klasie, na koÅ„cu pliku `/src/index.scss` dopiszÄ™ tylko takÄ… reguÅ‚Ä™:

```css
.highlight {
  background-color: #e3f2fd;
}
```

DziÄ™ki temu zaznaczony tekst otrzyma bardzo Å‚adne, bÅ‚Ä™kitne tÅ‚o.

I to tyle! DziÄ™ki tym czterem krokom oÅ¼ywiliÅ›my nasz przycisk, widoczny w narzÄ™dziach formatowania!

## To na koniec zadanie domowe (a nawet 2!)

Po pierwsze, sprÃ³buj uÅ¼yÄ‡ naszego nowego formatu (lub jakiegokolwiek innego) dla nagÅ‚Ã³wka naszego spisu treÅ›ci i zobacz, co dzieje siÄ™ na front-endzie. Podpowiem, Å¼e problem wyÅ›wietlania siÄ™ tagÃ³w HTMLa leÅ¼y w deklaracji atrybutÃ³w samego bloku.

I po drugie, dowiedz siÄ™ (i przetestuj), w jaki sposÃ³b moÅ¼na ograniczyÄ‡ wyÅ›wietlanie naszego przycisku, tylko do konkretnego komponentu (na przykÅ‚ad naszego spisu treÅ›ci). Bo obecnie, jak moÅ¼esz zauwaÅ¼yÄ‡, dodany przycisk aplikuje siÄ™ dla spisu streÅ›ci, ale teÅ¼ wszystkich innych elementÃ³w tekstowych w Gutenbergu: nagÅ‚Ã³wkÃ³w, paragrafÃ³w, list itp.

Do tego na pewno przyda Ci siÄ™ [link z dokumentacji Format API](https://developer.wordpress.org/block-editor/how-to-guides/format-api/2-toolbar-button/).

Gdy siÄ™ z nimi uporasz (lub w razie jakichkolwiek problemÃ³w), daj znaÄ‡ w komentarzu. Kod, ktÃ³ry dziÅ› stworzyliÅ›my, oczywiÅ›cie moÅ¼esz sprawdziÄ‡ w caÅ‚oÅ›ci na [moim GitHubie](https://github.com/robert-orlinski/gutenberg-blocks-course-files/tree/006) ğŸŒ±
